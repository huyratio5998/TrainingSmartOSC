[
  {
    "Id": "1493873",
    "ThreadId": "661847",
    "Html": "What should happen is when the first ever product of its kind is added to the cart, a new cart object is created, then if the same item is added to the shopping cart, the cart object with the same ProductId is fetched and the count variable is incremented. <br />\n<br />\nFor some reason, I keep creating a new cart even for the same product being added to the Shopping Cart. <br />\n<br />\nHere's the controller method to AddToCart:<br />\n<pre><code>[HttpPost]\n        public ActionResult AddToCart(int id)\n        {\n            var addedProduct = db.Products.Single(p =&gt; p.Id == id);\n            var productName = addedProduct.Name;\n\n            var cart = ShoppingCart.GetShoppingCart(this.HttpContext);\n\n            cart.AddItemToCart(addedProduct);\n\n            var results = new ShoppingCartAddViewModel\n            {\n                Message = Server.HtmlEncode(productName) +\n                    &quot; has been added to your shopping cart.&quot;,\n                CartTotal = cart.GetTotal(),\n                CartCount = cart.GetCount()\n            };\n\n            return Json(results);\n        }</code></pre>\n\nHere is the actual AddItemToCart method:<br />\n<pre><code>public void AddItemToCart(Product product)\n        {\n            var cartItem = db.Carts.SingleOrDefault(c =&gt; c.CartId == ShoppingCartId &amp;&amp;\n                                                     c.ProductId == product.Id);\n\n            if (cartItem == null)\n            {\n                cartItem = new Cart\n                {\n                    ProductId = product.Id,\n                    CartId = ShoppingCartId,\n                    Count = 1,\n                    DateCreated = DateTime.Now, \n                    Product = product\n                };\n                db.Carts.Add(cartItem);\n            }\n            else\n            {\n                cartItem.Count++;\n            }\n            db.SaveChanges();\n        }</code></pre>\n\n",
    "PostedDate": "2017-03-10T06:16:17.143-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]